## **Требования**
* docker version 20.10.3
----
## **Установка и запуск**
Перейти в директорию проекта и запустить две команды:
``` 
docker network create net-app &&
docker build -t app-image . &&
docker run --name db \
 -d --network net-app \
 --network-alias mysql \
 -v ${PWD}/init.sql:/docker-entrypoint-initdb.d/init.sql \
 --env-file env-db.txt \
mysql:5.7
```
```
docker run --name stats-app -dp 8080:8080 --env-file env-app.txt app-image
```

### **Note:**
Запускается сначала контейнер с базой данных mysql, потом контейнер с самим приложением.
Возникла проблема с синхронизацией запуска в docker-compose.

----
## **Описание методов**

### **POST /stats**
Метод сохранения статистики <br>
Если применять для уже существующей даты, то значения *clicks*, *views* инкрементируются, а *cost* обновляется

**Параметры:**
* Обязательные:
    * `date` - дата в формате *YYYY-MM-DD*.
* Опциональные:
    * `cost` - стоимость кликов, задается как десятичное число, в котором целая и дробная части разделены точкой, и дробная часть ограничена 2мя знаками.
    * `clicks`, `views` - количество кликов и просмотров, задаются как целое число.

**Пример использования:**

```
curl -X POST -d "date=2021-01-01&clicks=150&views=360&cost=555.63" http://localhost:8080/stats
```
```
curl -X POST -d "date=2020-11-23" http://localhost:8080/stats
```

**Возвращаемые значения:**

* Код **200**: метод успешно отработал
* Код **400**: неправильно введенные параметры
* Код **500**: ошибка сохранения или обновления данных

### **GET /stats**
Метод получения статистики

**Параметры:**
* Обязательные:
  * `from` - дата начала периода (включительно)
  * `to` - дата конца периода (включительно)
* Опциональные:
  * `orderby` - выходное поле, по которому можно сортировать ответ (ответ сортируется по убыванию). Значение по умолчанию - *date*. Возможные значения:
    * `date` - дата события
    * `views` - количество просмотров
    * `clicks` - количество кликов
    * `cost` - стоимость просмотров
    * `cpc` = cost/clicks - средяя стоимость кликов
    * `cpm` = (cost/views) * 1000 - средняя стоимость 1000 показов

**Пример использования:**

```
curl -G -d "from=2021-01-01&to=2021-05-05" http://localhost:8080/stats
```
```
curl -G -d "from=2021-10-11&to=2021-12-03&orderby=views" http://localhost:8080/stats
```

**Возвращаемые значения:**

* Код **200**: метод успешно отработал, вернул статистику в формате json, отсоритрованной по полю *orderby*

```
[
    {
        "date": "2021-01-11",
        "views": "150",
        "clicks": "63",
        "cost": "55.51",
        "cpc": "0.88",
        "cpm": "370.07"
    }
]
```
* Код **400**: направильно введенные параметры
* Код **500**: внутренняя ошибка

### **DELETE /stats**
Метод сброса статистики. Удаляет все содержимое.

**Параметры:**

Нет параметров (должен запускатья без каких либо параметров)

**Пример использования:**

```
curl -X DELETE http://localhost:8080/stats
```

**Возвращаемые значения:**

* Код **200**: метод успешно отработал, вернул количество удаленных строк в формате json

```
[
    {
        "affected": "51"
    }
]
```
* Код **400**: неправильно введенные параметры
* Код **500**: внутренняя ошибка
